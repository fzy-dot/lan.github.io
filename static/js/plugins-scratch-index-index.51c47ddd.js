(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["plugins-scratch-index-index"],{"057d":function(t,a,e){"use strict";e.r(a);var i=e("20cf"),n=e("2c65");for(var c in n)["default"].indexOf(c)<0&&function(t){e.d(a,t,(function(){return n[t]}))}(c);e("4ff4");var s,r=e("f0c5"),o=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"0c2c9be4",null,!1,i["a"],s);a["default"]=o.exports},"20cf":function(t,a,e){"use strict";var i;e.d(a,"b",(function(){return n})),e.d(a,"c",(function(){return c})),e.d(a,"a",(function(){return i}));var n=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("v-uni-view",{staticClass:"app-layout"},[i("app-layout",{attrs:{haveBackground:!1}},[i("v-uni-view",{staticClass:"scratch"},[i("v-uni-view",{staticClass:"bg",style:{"background-image":"url("+t.setting.bg_pic+")"}}),i("v-uni-view",{staticClass:"scratch-head"},[i("v-uni-view",{staticClass:"s-h",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.rules.apply(void 0,arguments)}}},[t._v("规则")]),i("v-uni-view",{staticClass:"s-h",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.share.apply(void 0,arguments)}}},[t._v("分享")]),i("app-share-qr-code-poster",{attrs:{theme:t.getTheme,url:t.poster,title:"生成海报"},on:{share:function(a){arguments[0]=a=t.$handleEvent(a),t.hShareAppMessage.apply(void 0,arguments)}},model:{value:t.shareShow,callback:function(a){t.shareShow=a},expression:"shareShow"}})],1),i("v-uni-view",{staticClass:"scratch-oppty"},[i("v-uni-view",[t._v("您还有"),i("v-uni-text",[t._v(t._s(t.oppty+t.free_oppty))]),t._v("次抽奖机会")],1)],1),i("v-uni-view",{staticClass:"container"},[i("v-uni-image",{staticClass:"image-bg-a",attrs:{src:e("c2d3"),"load-lazy":!0}}),i("v-uni-image",{staticClass:"image-bg-b",attrs:{id:"frame",src:e("52a2"),"load-lazy":!0}}),t.is_integral?i("v-uni-view",[i("v-uni-image",{staticClass:"image-bg-b",attrs:{src:e("7b4c"),"load-lazy":!0}}),i("v-uni-view",{staticClass:"image-bg-c",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.register.apply(void 0,arguments)}}},[t.free_oppty>0?i("v-uni-text",[t._v("免费刮"+t._s(t.free_oppty)+"次")]):i("v-uni-text",[t._v(t._s(t.setting.deplete_integral_num)+"积分刮一次")])],1)],1):i("v-uni-view",{staticClass:"integral-show"},[i("v-uni-view",{staticClass:"scratch-award main-center",attrs:{hidden:t.shareShow||t.userLoginShow}},[t.is_start?i("v-uni-canvas",{staticClass:"scratch-canvas",attrs:{id:"scratch","canvas-id":"scratch","disable-scroll":!0},on:{touchstart:function(a){arguments[0]=a=t.$handleEvent(a),t.touchStart.apply(void 0,arguments)},touchmove:function(a){arguments[0]=a=t.$handleEvent(a),t.touchMove.apply(void 0,arguments)},touchend:function(a){arguments[0]=a=t.$handleEvent(a),t.touchEnd.apply(void 0,arguments)}}}):t._e(),t.is_name?i("v-uni-view",{staticClass:"award-name"},[i("v-uni-text",[t._v(t._s(t.list?t.list.name:""))]),t.oppty+t.free_oppty>0?i("app-button",{attrs:{background:"#f05525",height:"80",width:"400","border-color":"#f05525",color:"#FFFFFF","font-size":"32",round:!0},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.onStart.apply(void 0,arguments)}}},[t._v("再刮一次")]):t._e(),t.oppty+t.free_oppty==0?i("app-button",{attrs:{background:"#cdcdcd",height:"80",width:"400","border-color":"#cdcdcd",color:"#FFFFFF","font-size":"32",round:!0},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.onStart.apply(void 0,arguments)}}},[t._v("再刮一次")]):t._e()],1):t._e()],1)],1)],1),i("v-uni-view",{staticClass:"dir-left-nowrap main-center cross-center end"},[i("v-uni-view",{staticClass:"dir-left-nowrap cross-center box-grow-0 left",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.home.apply(void 0,arguments)}}},[i("v-uni-icon",{staticClass:"end-icon home",attrs:{type:!0}}),i("v-uni-view",[t._v("回到首页")])],1),i("v-uni-view",{staticClass:"dir-left-nowrap cross-center box-grow-0",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.prize.apply(void 0,arguments)}}},[i("v-uni-view",[t._v("我的中奖记录")]),i("v-uni-icon",{staticClass:"end-icon price",attrs:{type:!0}})],1)],1),i("v-uni-view",{staticClass:"prize"},[i("v-uni-view",{staticClass:"dir-left-nowrap cross-center main-center"},[i("v-uni-view",{staticClass:"line"}),i("v-uni-view",{staticClass:"text"},[t._v("中奖名单")]),i("v-uni-view",{staticClass:"line"})],1),i("v-uni-swiper",{staticClass:"scratch-swiper",attrs:{duration:"500",vertical:"true",autoplay:"false"}},[i("v-uni-swiper-item",[t._l(t.logs,(function(a){return[i("v-uni-view",{key:a.id+"_0",staticClass:"scratch-item"},[t._v(t._s(a.create_time)+" "+t._s(a.user)+" "+t._s(a.name))])]}))],2)],1)],1)],1),t.is_award?i("v-uni-view",[i("v-uni-view",{staticClass:"act-modal"},[i("v-uni-view",{staticClass:"act-modal-bg"}),i("v-uni-view",{staticClass:"act-modal-pic cross-center main-center"},[i("v-uni-view",{staticClass:"success main-center"},[i("v-uni-icon",{staticClass:"image-bg",style:{"background-image":"url("+t.appImg.scratch_win+")"},attrs:{type:!0}}),i("v-uni-view",{staticClass:"dir-top-nowrap name main-center"},[i("v-uni-view",[t._v("恭喜获得")]),i("v-uni-text",{staticClass:"main-center"},[t._v(t._s(t.list.name))])],1)],1),i("v-uni-view",{staticClass:"act-modal-end dir-top-nowrap cross-center main-center"},[i("app-button",{attrs:{height:"72",width:"320",color:"#FFFFFF",background:"#f05525","border-color":"#f05525",round:!0},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.onStart.apply(void 0,arguments)}}},[t._v("再刮一次")]),i("v-uni-view",{staticClass:"act-zh"},[t._v("奖品已放入您的账号")])],1)],1)],1)],1):t._e()],1)],1)},c=[]},"2c65":function(t,a,e){"use strict";e.r(a);var i=e("7fe4"),n=e.n(i);for(var c in i)["default"].indexOf(c)<0&&function(t){e.d(a,t,(function(){return i[t]}))}(c);a["default"]=n.a},"4ff4":function(t,a,e){"use strict";var i=e("a9c5"),n=e.n(i);n.a},"52a2":function(t,a,e){t.exports=e.p+"static/img/scratch_border.528f1361.png"},"7b4c":function(t,a,e){t.exports=e.p+"static/img/scratch_hide.4f89dbde.png"},"7fe4":function(t,a,e){"use strict";var i=e("4ea4");e("8e6e"),e("ac6a"),e("456d"),Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=i(e("ade3")),c=i(e("409e")),s=e("2f62");function r(t,a){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);a&&(i=i.filter((function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),e.push.apply(e,i)}return e}function o(t){for(var a=1;a<arguments.length;a++){var e=null!=arguments[a]?arguments[a]:{};a%2?r(Object(e),!0).forEach((function(a){(0,n.default)(t,a,e[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):r(Object(e)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a))}))}return t}var d={name:"index",components:{appShareQrCodePoster:c.default},computed:o(o({},(0,s.mapGetters)("mallConfig",{getTheme:"getTheme"})),(0,s.mapState)({appImg:function(t){return t.mallConfig.plugin.scratch.app_image},userInfo:function(t){return t.user.info}})),data:function(){var t,a,e,i,n,c,s,r;return{ctx:t,interval:a,minX:e,minY:i,maxX:n,maxY:c,lastX:s,lastY:r,logs:[],setting:{},list:null,oppty:0,free_oppty:0,msg:"",is_start:!0,is_award:!1,is_name:!1,extra_list:null,touch_end:!0,poster:this.$api.scratch.poster,poster_status:!1,shareShow:!1,userLoginShow:!1,r:16,is_integral:!1}},watch:{shareShow:function(t,a){!1===t&&!0===a&&this.init()}},onUnload:function(){clearInterval(this.interval)},onHide:function(){clearInterval(this.interval)},onShow:function(){var t=this;t.$showLoading({title:"加载中"}),t.$request({url:t.$api.scratch.index}).then((function(a){if(t.$hideLoading(),t.is_award=!1,a.data){var e=a.data,i=e.oppty,n=e.list,c=e.free_oppty,s=e.setting,r=[1===a.code?a.msg:"",s,i,n,c];t.msg=r[0],t.setting=r[1],t.oppty=r[2],t.list=r[3],t.free_oppty=r[4],t.is_integral=s.deplete_integral_num>0}else uni.showToast({title:a.msg,icon:"none"});t.init()})),t.prizeList(),t.interval=setInterval((function(){t.prizeList()}),1e4)},methods:{hShareAppMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.$shareAppMessage({title:this.$children[0].navigationBarTitle,path:"/plugins/scratch/index/index",params:{}},t)},register:function(){this.msg?uni.showToast({icon:"none",title:this.msg}):(this.is_integral=!1,this.init())},share:function(){this.shareShow=!0},home:function(){uni.redirectTo({url:"/pages/index/index"})},prize:function(){uni.navigateTo({url:"/plugins/scratch/prize/prize"})},rules:function(){uni.navigateTo({url:"/pages/rules/index?url=".concat(encodeURIComponent(this.$api.scratch.setting),"&keys=").concat(JSON.stringify(["setting","rule"]))})},prizeList:function(){var t=this;t.$request({url:t.$api.scratch.record}).then((function(a){0===a.code&&(t.logs=a.data)}))},onStart:function(){this.init();var t=[this.setting.deplete_integral_num>0,this.extra_list,!1];this.is_integral=t[0],this.list=t[1],this.is_award=t[2]},init:function(){var t=this,a=[!0,!1];t.is_start=a[0],t.is_name=a[1],setTimeout((function(){var a=uni.createSelectorQuery();a.select("#frame").boundingClientRect(),a.exec((function(a){var e=a[0].width,i=a[0].height,n="./../image/scratch_hide.png",c=["","","","","",""];t.lastX=c[0],t.lastY=c[1],t.minX=c[2],t.minY=c[3],t.maxX=c[4],t.maxY=c[5];var s=[16,e,i];t.r=s[0],t.canvasWidth=s[1],t.canvasHeight=s[2];var r=uni.createCanvasContext("scratch");r.drawImage(n,0,0,e,i),t.ctx=r,r.draw(!0,(function(a){t.is_name=!0}))}))}))},drawRect:function(t,a){var e=this,i=e.r/2,n=t-i>0?t-i:0,c=a-i>0?a-i:0;if(""!==e.minX)e.minX=e.minX>n?n:e.minX,e.minY=e.minY>c?c:e.minY,e.maxX=e.maxX>n?e.maxX:n,e.maxY=e.maxY>c?e.maxY:c;else{var s=[n,c,n,c];e.minX=s[0],e.minY=s[1],e.maxX=s[2],e.maxY=s[3]}var r=[n,c];return e.lastX=r[0],e.lastY=r[1],[n,c,2*i]},clearArc:function(t,a,e){var i=this.r,n=this.ctx,c=i-e,s=Math.sqrt(i*i-c*c),r=t-c,o=a-s,d=2*c,l=2*s;e<=i&&(n.clearRect(r,o,d,l),e+=2,this.clearArc(t,a,e))},touchStart:function(t){var a=this;"User ID不能为空。"===a.msg?(this.userLoginShow=!0,a.$store.dispatch("user/info")):a.msg&&uni.showToast({icon:"none",title:a.msg})},touchMove:function(t){if(this.is_start&&!this.msg){var a=2;this.drawRect(t.touches[0].x,t.touches[0].y),this.clearArc(t.touches[0].x,t.touches[0].y,a),this.ctx.draw(!0)}},touchEnd:function(t){var a=this;if(a.is_start&&!a.msg){var e=a.canvasWidth,i=a.canvasHeight,n=a.minX,c=a.minY,s=a.maxX,r=a.maxY;s-n>.4*e&&r-c>.4*i&&a.touch_end&&(a.touch_end=!1,a.$request({url:a.$api.scratch.receive,data:{id:a.list.id}}).then((function(t){if(0===t.code){a.ctx.draw();var e=[t.msg,t.data.setting,t.data.oppty,t.data.list,t.data.free_oppty];a.msg=e[0],a.setting=e[1],a.oppty=e[2],a.extra_list=e[3],a.free_oppty=e[4];var i=[!1,5!=a.list.type];a.is_start=i[0],a.is_award=i[1]}else uni.showToast({icon:"none",content:t.msg}),a.onStart();a.touch_end=!0})))}}}};a.default=d},a9c5:function(t,a,e){var i=e("c4a2");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=e("4f06").default;n("6cef358f",i,!0,{sourceMap:!1,shadowMode:!1})},c2d3:function(t,a,e){t.exports=e.p+"static/img/scratch_border_bg.ac4ffce5.png"},c4a2:function(t,a,e){a=t.exports=e("24fb")(!1);var i=e("b605"),n=i(e("f39d")),c=i(e("ee44"));a.push([t.i,'@charset "UTF-8";.text-center[data-v-0c2c9be4]{text-align:center}.font-weight[data-v-0c2c9be4]{font-weight:700}.page-width[data-v-0c2c9be4]{width:100%}.goods-hover-class[data-v-0c2c9be4]{opacity:.9;background-color:#f7f7f7}.background-image[data-v-0c2c9be4]{background-repeat:no-repeat;background-size:100% 100%;background-position:50%}\n/*全局文字大小*/\n/* 屏幕宽度*/uni-page-body[data-v-0c2c9be4]{font-size:%?32?%;background:#f7f7f7}.page-width[data-v-0c2c9be4]{width:100%}.u-hover-class[data-v-0c2c9be4]{opacity:.9;background-color:#f7f7f7}.safe-area-inset-bottom[data-v-0c2c9be4]{padding-bottom:0;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}.app-layout[data-v-0c2c9be4] .app-layout{background:#5e00b8;min-height:100vh}.scratch-canvas[data-v-0c2c9be4]{width:%?600?%;height:%?320?%;position:absolute;left:0;z-index:1}.scratch[data-v-0c2c9be4]{text-align:center;padding-bottom:%?1?%}.scratch .bg[data-v-0c2c9be4]{position:absolute;left:0;top:0;height:100vh;width:100%;display:block;background-repeat:no-repeat;background-size:100% 100%}.scratch .scratch-head .s-h[data-v-0c2c9be4]{color:#fff;font-size:%?24?%;background:#000;text-align:center;background-color:rgba(0,0,0,.3);line-height:%?48?%;width:%?92?%;border-radius:%?24?% 0 0 %?24?%;position:absolute;right:0;z-index:1;top:%?40?%}.scratch .scratch-head .s-h[data-v-0c2c9be4]:nth-child(2){top:%?112?%}.scratch .scratch-oppty[data-v-0c2c9be4]{line-height:%?56?%;font-size:%?28?%;padding-top:%?380?%;position:relative}.scratch .scratch-oppty uni-view[data-v-0c2c9be4]{color:#fff;padding:0 %?30?%;display:inline-block;background:rgba(0,0,0,.3);border-radius:%?28?%}.scratch .scratch-oppty uni-text[data-v-0c2c9be4]{color:#ffb92a}.scratch .container[data-v-0c2c9be4]{position:relative;margin-top:%?40?%;margin-bottom:%?48?%;height:%?360?%;width:100%}.scratch .container .image-bg-a[data-v-0c2c9be4]{height:%?360?%;width:%?654?%}.scratch .container .image-bg-b[data-v-0c2c9be4]{height:%?320?%;width:%?600?%;position:absolute;top:%?20?%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%);transform:translate(-50%)}.scratch .container .image-bg-c[data-v-0c2c9be4]{position:absolute;top:%?150?%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%);transform:translate(-50%);line-height:%?80?%;background:#f05525;border-radius:%?40?%;padding:0 %?48?%;color:#fff}.scratch .end[data-v-0c2c9be4]{position:relative;color:#fff;font-size:%?28?%}.scratch .end .left[data-v-0c2c9be4]{margin-right:%?160?%}.scratch .end .end-icon[data-v-0c2c9be4]{background-repeat:no-repeat;background-size:100% 100%;margin:0 %?16?%}.scratch .end .end-icon.home[data-v-0c2c9be4]{height:%?30?%;width:%?30?%;background-image:url('+n+")}.scratch .end .end-icon.price[data-v-0c2c9be4]{height:%?22?%;width:%?12?%;background-image:url("+c+")}.scratch .prize[data-v-0c2c9be4]{position:relative;height:%?186?%;width:%?654?%;background:#420080;display:inline-block;border-radius:%?16?%;text-align:left;padding-top:%?26?%;margin-top:%?48?%}.scratch .prize .line[data-v-0c2c9be4]{height:1px;width:%?120?%;background:#fff}.scratch .prize .text[data-v-0c2c9be4]{padding:0 %?40?%;color:#fff;font-size:%?28?%;padding-bottom:%?12?%}.scratch .prize .scratch-swiper[data-v-0c2c9be4]{height:%?110?%;font-size:%?24?%;color:#fff}.scratch .prize .scratch-item[data-v-0c2c9be4]{line-height:%?40?%;padding:0 %?50?%;display:inline-block;white-space:nowrap;width:100%;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}.scratch .integral-show[data-v-0c2c9be4]{position:absolute;top:%?20?%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%);transform:translate(-50%);width:%?600?%;height:%?320?%}.scratch .integral-show .scratch-award[data-v-0c2c9be4]{width:100%;height:100%}.scratch .integral-show .scratch-award .award-name uni-text[data-v-0c2c9be4]{width:%?410?%;color:#f05525;font-size:%?36?%;margin-bottom:%?40?%;margin-top:%?88?%;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical}.scratch .scraxtch-award uni-view[data-v-0c2c9be4]{width:%?400?%;line-height:%?80?%;color:#fff;margin-top:%?40?%;border-radius:%?40?%}.scratch .scraxtch-award .next[data-v-0c2c9be4]{background:#f05525}.scratch .scraxtch-award .none[data-v-0c2c9be4]{background:#cdcdcd}.act-modal[data-v-0c2c9be4]{position:fixed;left:0;top:0;width:100%;height:100%;z-index:2001;-webkit-transition:.2s;-o-transition:.2s;transition:.2s}.act-modal .show[data-v-0c2c9be4]{visibility:visible;opacity:1}.act-modal .act-modal-bg[data-v-0c2c9be4]{background:rgba(0,0,0,.5);position:fixed;left:0;top:0;width:100%;height:100%;z-index:1}.act-modal .act-modal-pic[data-v-0c2c9be4]{background:rgba(0,0,0,.25);position:fixed;left:0;top:0;width:100%;height:100%;z-index:1}.act-modal .success[data-v-0c2c9be4]{position:absolute;top:0;width:100%;left:0}.act-modal .success .image-bg[data-v-0c2c9be4]{height:%?733?%;width:100%;background-repeat:no-repeat;background-size:100% 100%}.act-modal .success .name[data-v-0c2c9be4]{position:absolute;top:%?540?%;font-size:%?32?%;color:#f05525;left:50%;right:0;text-align:center;-webkit-transform:translate(-50%);-ms-transform:translate(-50%);transform:translate(-50%)}.act-modal .success .name uni-view[data-v-0c2c9be4]{padding-bottom:%?10?%}.act-modal .act-modal-end[data-v-0c2c9be4]{position:absolute;top:%?730?%;border-bottom:%?10?% solid #ffb947;border-radius:0 0 %?24?% %?24?%;border-left:%?10?% solid #ffb947;border-right:%?10?% solid #ffb947;width:%?490?%;background:#fff;height:%?160?%;left:0;right:0;margin:0 auto}.act-modal .act-modal-end .act-zh[data-v-0c2c9be4]{margin-top:%?24?%;font-size:%?24?%;color:#999}body.?%PAGE?%[data-v-0c2c9be4]{background:#f7f7f7}",""])},ee44:function(t,a){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAWCAMAAADD5o0oAAAATlBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////+QlxstAAAAGXRSTlMAgtioHRUF5vjPvZOOdmdhUklA8LW0nZx9eessiAAAAFJJREFUGNNlz0kOwDAIA8BsTbqmexv//6M52hKcGAkBdrd3rAjVglXk8Ys2RFHFm6kds+jANFAnguhCSFQaiwXHdIGutkcrnqyPMsJnwpnYpbHvG2IDzAb67NcAAAAASUVORK5CYII="},f39d:function(t,a){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAAeFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////GqOSsAAAAJ3RSTlMA7vZxHAzbTrnnxq1qKXgi4Vb61THPiIM5B1pHzMCVfGZgFQOkm0FlsDljAAABX0lEQVQoz33T15KDMAwFUMkNbNNblpJASNH//+ESe9gFksl9AM+cEUYusIlMGGIWydgwlbRwTJJRhlReLBHVndyj5EzxIH8g0TBaCsVeEyq75Z02muw8kUp3GpHu3Ug0aOKI6l11ghjc/DA+NYLTIHaa9bBGiHYks2HOyhy2OVEtN/OqvUKE7NquHZE+KFSXxX09R+zbA99EwnByf6Vd7TFzwzJ+gxHdarxHXAqVA2ZX+Jz4zs6AVryLT44a0Dzl3L5bK2SHDHRRh+G9Omplw7AkBtwwIgqO3BERmgYgGC+4ctw/Zz+aCtXwQLoP1YVj2VuGp1j6Xbin6zyl4xtXjAjPnVt0Zlf+UbRwG9Rkg9djdhzGOxa2CJcGeqO5/MCpIg5LRjqLL3wi85Vd9bTh7J2DwlT/PAHIkhLPoXzt5l9j6YMMzznz3JCO8gfhVa4npzJaDSWqqz9behgy9JfoF/JtGymuSKKSAAAAAElFTkSuQmCC"}}]);